---
import { endpointFetch } from "../functions/endpoint"

const runtime = Astro.locals.runtime;
const endpoint = endpointFetch( runtime.env.ENVIRONMENT )

// NETWORK CALL TO GET DATA
const network_data = await fetch( endpoint + "/home" )
const data_json = await network_data.json()

const { home, case_studies, locations, blogs, testimonials, meta_tags } = data_json.data

// HOME PROPS
let hero = null
let services = null
let nearshoring = null
let read_why = null
let case_study = null
let latest_insights = null

home.map( ( data ) => {

	if( data.slug === "hero" )
		hero = data
    else if( data.slug === "services" )
		services = data
	else if ( data.slug === "nearshoring" )
		nearshoring = data
    else if ( data.slug === "read-why" )
		read_why = data
    else if ( data.slug === "case-studies" )
        case_study = data
    else if ( data.slug === "latest-insights" )
		latest_insights = data

})


// IMPORT ASTRO LAYOUTS
import Layout from "../layouts/Layout.astro"
import Container from "../layouts/Container.astro"

// IMPORT ASTRO COMPONENTS
import Footer from "../components/common/footer/Footer.astro"
import Header from "../components/common/header/Header.astro"
import HeaderBanner from "../components/common/HeaderBanner.astro"

import CaseStudies from "../components/home/case-studies/CaseStudies"
import Hero from "../components/home/hero/Hero.astro"
import LatestInsights from "../components/home/latest-insights/LatestInsights.astro"
import Locations from "../components/home/locations/Locations"
import ReadWhy from "../components/home/ReadWhy.astro"
import ServicesAndNearShoring from "../components/home/ServicesAndNearShoring"
import Testimonials from "../components/home/Testimonials.astro"

// IMPORT CONSTANTS
import { CDN_LINK } from "../constants/cdn"
---
<Layout
	title={ meta_tags.title }
	description={ meta_tags.description }
	image={ CDN_LINK + meta_tags.cover }
>
	<HeaderBanner />
	<Header />
	<Hero data={ hero } />
	<ServicesAndNearShoring
		client:load
		services={ services }
		nearshoring={ nearshoring }
	/>
	<Locations client:load />
	<ReadWhy data={ read_why } />
	<CaseStudies
		client:load
		case_study={ case_study }
	/>
	<LatestInsights insights={ latest_insights } />
	<Testimonials />
	<Footer />
</Layout>
